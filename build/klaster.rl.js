/*
 klaster.js Version: 0.9.7 01-12-2017 11:50:06  fast-json-patch, version: 2.0.6  https://github.com/Starcounter-Jack/JSON-Patch
 (c) 2017 Joachim Wester
 MIT license
*/
var prefix="data",k_docapi={Controller:{"this.interactions":{"dom-attribute name":{"on-name":"event callback handler, params(e, controller) context(this) is jQuery dom element"}},"this.delay":"integer delay in milliseconds used for changes on model call to sync function timeout",change:"callback that executes after change of model data(this.model.values) with a delay of milliseconds declared with this.delay default 0"},"dom-attributes":{defaultvalues:{attr:prefix+"-defaultvalues",value:'String value:"client" or "server" that means our app uses the field.values frtom dom or model/javascript'},
name:{attr:prefix+"-name",value:"String containing name of element, not unique"},omit:{attr:prefix+"-omit",value:"String/that evaluates to boolean, whether ignoring the area for model representation data or not"},filter:{attr:prefix+"-filter",value:"filter expression javascript is valid"},value:{attr:prefix+"-value",value:"String, containing the value of an element, can be plain or json"},multiple:{attr:prefix+"-multiple",value:"String/that evaluates to boolean, whether this element is part of multiple elements like checkbox",
children:{checked:{attr:prefix+"-checked",value:"String/that evaluates to boolean, whether this element is will apear inside a list of multiple elements with similar data-name, like checkbox"}}},delay:{attr:prefix+"-delay",value:"number of miliseconds until sync"},on:{attr:prefix+"-on",value:"event that triggers matching action method, also alias is possible. eg. hover->klasterhover"},view:{attr:prefix+"-view",value:{desc:"defines which view function callback is executed for rendering output",params:{"[viewname]":"name of view render function (calls it) and uses return string to fill html of this element",
"for->[viewname]":"name of view render function and calls it for every array item and uses return string to fill html of this elements"},definition:{iterate:"foreach->"}}}}},k_structure={delay:10,api:k_docapi,interactions:{test:{click:function(l){}}},model:{field:{},event:{postChange:{fieldabc:"function () {}"},sync:"function () {}"},state:{}},viewFilter:{},view:{viewpath:"view/",fileextension:"html.twig",templates_:{},render:function(l,a){},views:{test:function(){}}},filter:{},config:{debug:!0,skeleton:!0}},
k_dom=function(l){function a(f){"undefined"===typeof c.multipleValues[f]&&this.getAttribute(l.multiple.attr)&&(f=l.multiple.attr);return c.multipleValues[f].call(this)}function h(){if("true"!==this.getAttribute(l.omit.attr))return this.getAttribute(l.value.attr)||this.value||this.innerHTML}l=l["dom-attributes"];var c={addFilter:function(f){this.setAttribute(l.filter,f)},getName:function(f){if(3!==f.nodeType)return f.getAttribute(c.nameAttr(f))},nameAttr:function(f){return f.getAttribute(l.name.attr)?
l.name.attr:"name"},toggleOmit:function(f){f.setAttribute(l.omit.attr,!(f.getAttribute(l.omit.attr)&&"true"===f.getAttribute(l.omit.attr).toLowerCase()));return f},getXPath:function(f){if("string"===typeof f)return document.evaluate(f,document,null,0,null);if(!f||1!=f.nodeType)return"";if(f.id)return"//*[@id='"+f.id+"']";var a=[].filter.call(f.parentNode.children,function(b){return b.tagName==f.tagName});return c.getXPath.call(f.parentNode)+"/"+f.tagName.toLowerCase()+(1<a.length?"["+([].indexOf.call(a,
f)+1)+"]":"")}};c.value=h;c.multipleValues={checked:function(f,a,b){if("false"===f.getAttribute(l.multiple.attr)||b||1===document.querySelectorAll("["+c.nameAttr(f)+'="'+c.getName(f)+'"]').length)return f.checked;var p=[],v=void 0;Array.prototype.forEach.call(a,function(b,f){v=h.call(b);"undefined"!==typeof v&&p.push(v)});return p},checkbox:function(){return c.multipleValues.checked(this,document.querySelectorAll("["+c.nameAttr(this)+'="'+c.getName(this)+'"]:checked'))},radio:function(){return c.multipleValues.checked(this,
document.querySelectorAll("["+c.nameAttr(this)+'="'+c.getName(this)+'"]:checked'),!0)},"data-multiple":function(){return c.multipleValues.checked(this,document.querySelectorAll("["+c.nameAttr(this)+'="'+c.getName(this)+'"][data-checked="true"]'))}};c.hasMultipleChoices=function(f){var a=["radio","checkbox"];console.log(a,f.getAttribute("type"),a.indexOf(f.getAttribute("type")));return-1<a.indexOf(f.getAttribute("type"))||"true"===f.getAttribute("data-multiple")};c.selectMultiple=function(f,a){if("undefined"!==
typeof a&&null!==a){var b=document.querySelectorAll("["+c.nameAttr(f)+'="'+c.getName(f)+'"]');"[object Array]"!==Object.prototype.toString.call(a)&&(a=[a]);Array.prototype.forEach.call(b,function(b){b.checked=a[0]})}};c.getHtml=function(a){return a.innerHTML};c.setHtml=function(a,c){a.innerHTML=c};c.getParents=function(a,c){for(var b;a&&a!==document;){if(b=a.parentNode.querySelector(c))return b;a=a.parentNode}return null};c.getView=function(a){return a.getAttribute(l.view.attr)||c.getFieldView(c.getName(a),
!0)};c.getFieldView=function(a,h){if("undefined"===typeof a)return!1;var b=!1,f=!1;"undefined"===typeof c.child.view.views[a]?-1!==a.indexOf("[")&&(b=a.match(/([a-z].*?\[\w.*\])/gi),"undefined"!==typeof b&&b&&(b=b.pop()),f="undefined"!==typeof c.child.view.views[a.split("[")[0]+"[*]"]?b.split("[").pop()+"[*]":a,b="undefined"!==typeof c.child.view.views[a.split("[")[0]+"[*]"]?c.child.view.views[b.split("[").pop()+"[*]"]:void 0):(b=c.child.view.views[a],f=a);return"undefined"!==typeof c.child.view.views[f]?
h?f:b:!1};c.normalizeChangeResponse=function(a){if("["!==a.substr(0,1))return a;if(a){var f=/\[(.*?)\]/.exec(a),b=a;if(f)for(b=a.replace(f[0],f[1]);null!=(f=/\[([a-z].*?)\]/ig.exec(b));)b=b.replace(f[0],"."+f[1]);return b}};c.normalizeChangeResponseBrackets=function(a){if("["!==a.substr(0,1))return a;if(a){var f=/\[(.*?)\]/.exec(a),b=a;if(f)for(b=a.replace(f[0],f[1]);null!=(f=/\[([a-z].*?)\]/ig.exec(b));)b=b.replace(f[0],"['"+f[1]+"']");return b}};c.is=function(a,c){return a.tagName.toLowerCase()===
c.toLowerCase()};c.isPrimitiveValue=function(a){return c.is(a,"input")||c.is(a,"select")||c.is(a,"textarea")};c.setPrimitiveValue=function(a,c){null!==a.getAttribute(l.value.attr)?a.setAttribute(l.value.attr,c):"textarea"===a.type?a.innerHTML=c:a.value=c};c.setHtmlValue=function(a){"undefined"===typeof a&&(a="");this.innerHTML=a};c.hasView=function(a){return a.getAttribute(l.view.attr)||c.getFieldView(c.getName(a),!0)};c.getSelector=function(a,c){c&&(a=a.replace(/\[/g,"[").replace(/\]/g,"]"));return'[data-name="'+
a+'"],[name="'+a+'"]'};c.getValidatorSelector=function(a,c){a=a.replace(/\[/g,"[").replace(/\]/g,"]");c=c.replace(/\[/g,"[").replace(/\]/g,"]");return'[data-name="'+a+'"][data-view="'+c+'"], [name="'+a+'"][data-view="'+c+'"]'};c.isHtmlList=function(a){return a.getAttribute(l.view.attr)&&-1!==a.getAttribute(l.view.attr).indexOf(l.view.value.definition.iterate)};c.parseHTML=function(a){var c=document.createElement("template");c.innerHTML=a;return c.content.cloneNode(!0).childNodes[0]};c.getValues=a;
c.getValue=function(f,p){if(!c.getParents(f,"["+l.omit.attr+'="true"]')&&"true"!==f.getAttribute(l.omit.attr)){if("function"!==typeof c.multipleValues[f.getAttribute("type")]||"false"===f.getAttribute(l.multiple.attr))return h.call(f);if(p||"true"===f.getAttribute(l.multiple.attr)||"function"===typeof c.multipleValues[f.getAttribute("type")])return a.call(f,f.getAttribute("type"))}};return c}(k_docapi),jsonpatch=function(l){function a(c){if(h[c])return h[c].exports;var f=h[c]={i:c,l:!1,exports:{}};
l[c].call(f.exports,f,f.exports,a);f.l=!0;return f.exports}var h={};a.m=l;a.c=h;a.i=function(a){return a};a.d=function(c,f,h){a.o(c,f)||Object.defineProperty(c,f,{configurable:!1,enumerable:!0,get:h})};a.n=function(c){var f=c&&c.__esModule?function(){return c["default"]}:function(){return c};a.d(f,"a",f);return f};a.o=function(a,f){return Object.prototype.hasOwnProperty.call(a,f)};a.p="";return a(a.s=3)}([function(l,a){function h(a,b){return v.call(a,b)}function c(a){if(Array.isArray(a)){var b=Array(a.length);
for(a=0;a<b.length;a++)b[a]=""+a;return b}if(Object.keys)return Object.keys(a);b=[];for(var d in a)h(a,d)&&b.push(d);return b}function f(a){return-1===a.indexOf("/")&&-1===a.indexOf("~")?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function p(a,b){var d;for(d in a)if(h(a,d)){if(a[d]===b)return f(d)+"/";if("object"===typeof a[d]){var k=p(a[d],b);if(""!=k)return f(d)+"/"+k}}return""}function b(a){if(void 0===a)return!0;if(a)if(Array.isArray(a))for(var d=0,f=a.length;d<f;d++){if(b(a[d]))return!0}else if("object"===
typeof a){f=c(a);var k=f.length;for(d=0;d<k;d++)if(b(a[f[d]]))return!0}return!1}var q=this&&this.__extends||function(a,b){function d(){this.constructor=a}for(var k in b)b.hasOwnProperty(k)&&(a[k]=b[k]);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)},v=Object.prototype.hasOwnProperty;a.hasOwnProperty=h;a._objectKeys=c;a._deepClone=function(a){switch(typeof a){case "object":return JSON.parse(JSON.stringify(a));case "undefined":return null;default:return a}};a.isInteger=function(a){for(var b=
0,d=a.length,k;b<d;)if(k=a.charCodeAt(b),48<=k&&57>=k)b++;else return!1;return!0};a.escapePathComponent=f;a.unescapePathComponent=function(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")};a._getPathRecursive=p;a.getPath=function(a,b){if(a===b)return"/";var d=p(a,b);if(""===d)throw Error("Object not found in root");return"/"+d};a.hasUndefined=b;var d=function(a){function b(b,d,g,n,c){a.call(this,b);this.message=b;this.name=d;this.index=g;this.operation=n;this.tree=c}q(b,a);return b}(Error);a.PatchError=
d},function(l,a,h){function c(a,g){if(""==g)return a;var b={op:"_get",path:g};f(a,b);return b.value}function f(k,g,n,m){void 0===n&&(n=!1);void 0===m&&(m=!0);n&&("function"==typeof n?n(g,0,k,g.path):b(g,0));if(""===g.path){m={newDocument:k};if("add"===g.op)return m.newDocument=g.value,m;if("replace"===g.op)return m.newDocument=g.value,m.removed=k,m;if("move"===g.op||"copy"===g.op)return m.newDocument=c(k,g.from),"move"===g.op&&(m.removed=k),m;if("test"===g.op){m.test=d(k,g.value,v);if(!1===m.test)throw new a.JsonPatchError("Test operation failed",
"TEST_OPERATION_FAILED",0,g,k);m.newDocument=k;return m}if("remove"===g.op)return m.removed=k,m.newDocument=null,m;if("_get"===g.op)return g.value=k,m;if(n)throw new a.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,g,k);return m}m||(k=t._deepClone(k));m=(g.path||"").split("/");var f=k,h=1,q=m.length,u=void 0,l;for(l="function"==typeof n?n:b;;){var p=m[h];n&&void 0===u&&(void 0===f[p]?u=m.slice(0,h).join("/"):h==q-1&&(u=g.path),void 0!==
u&&l(g,0,k,u));h++;if(Array.isArray(f)){if("-"===p)p=f.length;else{if(n&&!t.isInteger(p))throw new a.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,g.path,g);t.isInteger(p)&&(p=~~p)}if(h>=q){if(n&&"add"===g.op&&p>f.length)throw new a.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,g.path,
g);m=x[g.op].call(g,f,p,k);if(!1===m.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,g,k);return m}}else if(p&&-1!=p.indexOf("~")&&(p=t.unescapePathComponent(p)),h>=q){m=w[g.op].call(g,f,p,k);if(!1===m.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,g,k);return m}f=f[p]}}function p(b,g,d,c){void 0===c&&(c=!0);if(d&&!Array.isArray(g))throw new a.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");c||(b=t._deepClone(b));
c=Array(g.length);for(var k=0,n=g.length;k<n;k++)c[k]=f(b,g[k],d),b=c[k].newDocument;c.newDocument=b;return c}function b(b,g,d,c){if("object"!==typeof b||null===b||Array.isArray(b))throw new a.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",g,b,d);if(w[b.op]){if("string"!==typeof b.path)throw new a.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",g,b,d);if(0!==b.path.indexOf("/")&&0<b.path.length)throw new a.JsonPatchError('Operation `path` property must start with "/"',
"OPERATION_PATH_INVALID",g,b,d);if("move"!==b.op&&"copy"!==b.op||"string"===typeof b.from)if("add"!==b.op&&"replace"!==b.op&&"test"!==b.op||void 0!==b.value){if(("add"===b.op||"replace"===b.op||"test"===b.op)&&t.hasUndefined(b.value))throw new a.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",g,b,d);if(d)if("add"==b.op){var n=b.path.split("/").length;c=c.split("/").length;if(n!==c+1&&n!==c)throw new a.JsonPatchError("Cannot perform an `add` operation at the desired path",
"OPERATION_PATH_CANNOT_ADD",g,b,d);}else if("replace"===b.op||"remove"===b.op||"_get"===b.op){if(b.path!==c)throw new a.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",g,b,d);}else if(("move"===b.op||"copy"===b.op)&&(n=q([{op:"_get",path:b.from,value:void 0}],d))&&"OPERATION_PATH_UNRESOLVABLE"===n.name)throw new a.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",g,b,d);}else throw new a.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)",
"OPERATION_VALUE_REQUIRED",g,b,d);else throw new a.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",g,b,d);}else throw new a.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",g,b,d);}function q(d,g,c){try{if(!Array.isArray(d))throw new a.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(g)p(t._deepClone(g),t._deepClone(d),c||!0);else{c=
c||b;for(var n=0;n<d.length;n++)c(d[n],n,g,void 0)}}catch(r){if(r instanceof a.JsonPatchError)return r;throw r;}}var v={strict:!0},d=h(2),t=h(0);a.JsonPatchError=t.PatchError;a.deepClone=t._deepClone;var w={add:function(a,b,d){a[b]=this.value;return{newDocument:d}},remove:function(a,b,d){var g=a[b];delete a[b];return{newDocument:d,removed:g}},replace:function(a,b,d){var g=a[b];a[b]=this.value;return{newDocument:d,removed:g}},move:function(a,b,d){(a=c(d,this.path))&&(a=t._deepClone(a));b=f(d,{op:"remove",
path:this.from}).removed;f(d,{op:"add",path:this.path,value:b});return{newDocument:d,removed:a}},copy:function(a,b,d){a=c(d,this.from);f(d,{op:"add",path:this.path,value:t._deepClone(a)});return{newDocument:d}},test:function(a,b,c){return{newDocument:c,test:d(a[b],this.value,v)}},_get:function(a,b,d){this.value=a[b];return{newDocument:d}}},x={add:function(a,b,d){t.isInteger(b)?a.splice(b,0,this.value):a[b]=this.value;return{newDocument:d,index:b}},remove:function(a,b,d){a=a.splice(b,1);return{newDocument:d,
removed:a[0]}},replace:function(a,b,d){var g=a[b];a[b]=this.value;return{newDocument:d,removed:g}},move:w.move,copy:w.copy,test:w.test,_get:w._get};a.getValueByPointer=c;a.applyOperation=f;a.applyPatch=p;a.applyReducer=function(b,d){var g=f(b,d);if(!1===g.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,d,b);return g.newDocument};a.validator=b;a.validate=q},function(l,a,h){function c(a){return!a||"object"!==typeof a||"number"!==typeof a.length||"function"!==typeof a.copy||
"function"!==typeof a.slice||0<a.length&&"number"!==typeof a[0]?!1:!0}function f(a,f,h){var d;if(null===a||void 0===a||null===f||void 0===f||a.prototype!==f.prototype)return!1;if(q(a)){if(!q(f))return!1;a=p.call(a);f=p.call(f);return v(a,f,h)}if(c(a)){if(!c(f)||a.length!==f.length)return!1;for(d=0;d<a.length;d++)if(a[d]!==f[d])return!1;return!0}try{var k=b(a);var g=b(f)}catch(n){return!1}if(k.length!=g.length)return!1;k.sort();g.sort();for(d=k.length-1;0<=d;d--)if(k[d]!=g[d])return!1;for(d=k.length-
1;0<=d;d--)if(g=k[d],!v(a[g],f[g],h))return!1;return typeof a===typeof f}var p=Array.prototype.slice,b=h(5),q=h(4),v=l.exports=function(a,b,c){c||(c={});return a===b?!0:a instanceof Date&&b instanceof Date?a.getTime()===b.getTime():!a||!b||"object"!=typeof a&&"object"!=typeof b?c.strict?a===b:a==b:f(a,b,c)}},function(l,a,h){function c(a){for(var b=0,g=d.length;b<g;b++)if(d[b].obj===a)return d[b]}function f(a,b){for(var d=0,c=a.observers.length;d<c;d++)if(a.observers[d].callback===b)return a.observers[d].observer}
function p(a){for(var c,g=0,f=d.length;g<f;g++)if(d[g].obj===a.object){c=d[g];break}b(c.value,a.object,a.patches,"");a.patches.length&&v.applyPatch(c.value,a.patches);c=a.patches;0<c.length&&(a.patches=[],a.callback&&a.callback(c));return c}function b(a,d,g,c){if(d!==a){"function"===typeof d.toJSON&&(d=d.toJSON());for(var f=q._objectKeys(d),n=q._objectKeys(a),h=!1,k=n.length-1;0<=k;k--){var u=n[k],p=a[u];if(!q.hasOwnProperty(d,u)||void 0===d[u]&&void 0!==p&&!1===Array.isArray(d))g.push({op:"remove",
path:c+"/"+q.escapePathComponent(u)}),h=!0;else{var v=d[u];"object"==typeof p&&null!=p&&"object"==typeof v&&null!=v?b(p,v,g,c+"/"+q.escapePathComponent(u)):p!==v&&g.push({op:"replace",path:c+"/"+q.escapePathComponent(u),value:q._deepClone(v)})}}if(h||f.length!=n.length)for(k=0;k<f.length;k++)u=f[k],q.hasOwnProperty(a,u)||void 0===d[u]||g.push({op:"add",path:c+"/"+q.escapePathComponent(u),value:q._deepClone(d[u])})}}h(2);var q=h(0),v=h(1);l=h(1);a.applyOperation=l.applyOperation;a.applyPatch=l.applyPatch;
a.applyReducer=l.applyReducer;a.getValueByPointer=l.getValueByPointer;a.validate=l.validate;a.validator=l.validator;h=h(0);a.JsonPatchError=h.PatchError;a.deepClone=h._deepClone;a.escapePathComponent=h.escapePathComponent;a.unescapePathComponent=h.unescapePathComponent;var d=[],t=function(){return function(a){this.observers=[];this.obj=a}}(),w=function(){return function(a,b){this.callback=a;this.observer=b}}();a.unobserve=function(a,b){b.unobserve()};a.observe=function(a,b){var g=c(a);if(g)var n=
f(g,b);else g=new t(a),d.push(g);if(n)return n;n={};g.value=q._deepClone(a);if(b){n.callback=b;n.next=null;var h=function(){p(n)},r=function(){clearTimeout(n.next);n.next=setTimeout(h)};"undefined"!==typeof window&&(window.addEventListener?(window.addEventListener("mouseup",r),window.addEventListener("keyup",r),window.addEventListener("mousedown",r),window.addEventListener("keydown",r),window.addEventListener("change",r)):(document.documentElement.attachEvent("onmouseup",r),document.documentElement.attachEvent("onkeyup",
r),document.documentElement.attachEvent("onmousedown",r),document.documentElement.attachEvent("onkeydown",r),document.documentElement.attachEvent("onchange",r)))}n.patches=[];n.object=a;n.unobserve=function(){p(n);clearTimeout(n.next);a:for(var a=g,b=n,d=0,c=a.observers.length;d<c;d++)if(a.observers[d].observer===b){a.observers.splice(d,1);break a}"undefined"!==typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",r),window.removeEventListener("keyup",r),window.removeEventListener("mousedown",
r),window.removeEventListener("keydown",r)):(document.documentElement.detachEvent("onmouseup",r),document.documentElement.detachEvent("onkeyup",r),document.documentElement.detachEvent("onmousedown",r),document.documentElement.detachEvent("onkeydown",r)))};g.observers.push(new w(b,n));return n};a.generate=p;a.compare=function(a,d){var g=[];b(a,d,g,"");return g}},function(l,a){function h(a){return"[object Arguments]"==Object.prototype.toString.call(a)}function c(a){return a&&"object"==typeof a&&"number"==
typeof a.length&&Object.prototype.hasOwnProperty.call(a,"callee")&&!Object.prototype.propertyIsEnumerable.call(a,"callee")||!1}var f="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();a=l.exports=f?h:c;a.supported=h;a.unsupported=c},function(l,a){function h(a){var c=[],h;for(h in a)c.push(h);return c}a=l.exports="function"===typeof Object.keys?Object.keys:h;a.shim=h}]),k_data=function(l){var a={field:{}},h=Object.prototype.hasOwnProperty,c=Object.prototype.toString,
f=function(a){return"function"===typeof Array.isArray?Array.isArray(a):"[object Array]"===c.call(a)},p=function(a){if(!a||"[object Object]"!==c.call(a))return!1;var b=h.call(a,"constructor"),f=a.constructor&&a.constructor.prototype&&h.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!f)return!1;for(var d in a);return"undefined"===typeof d||h.call(a,d)};a.extend=function(){var b,c,h=arguments[0],d=1,l=arguments.length,w=!1;if("boolean"===typeof h)w=h,h=arguments[1]||{},d=2;else if("object"!==
typeof h&&"function"!==typeof h||null==h)h={};for(;d<l;++d){var x=arguments[d];if(null!=x)for(b in x){var k=h[b];var g=x[b];h!==g&&(w&&g&&(p(g)||(c=f(g)))?(c?(c=!1,k=k&&f(k)?k:[]):k=k&&p(k)?k:{},h[b]=a.extend(w,k,g)):"undefined"!==typeof g&&(h[b]=g))}}return h};a.has=function(a,c){return hasOwnProperty.call(a,c)};a._buildModelPreChangeObj=function(){a._modelprechange={};a._modelprechangeReal={};a._modelpresize=0;for(var b in a.field)if(a.has(a.field,b)&&null!==a.field[b]&&"undefined"!==typeof a.field[b]){a._modelprechange[b]=
a.field[b];var c={};"[object Array]"===Object.prototype.toString.call(a.field[b])&&(c=[]);a._modelprechangeReal[b]="string"!==typeof a.field[b]&&"number"!==typeof a.field[b]?a.extend(!0,c,a.field[b]):a.field[b];a._modelpresize++}};a.setState=function(b,c){if("undefined"===typeof c.result)throw{message:"A state has to contain a field 'result' of type boolean",name:"ValidationException"};"undefined"===typeof a.state&&(a.state=JSON.parse(JSON.stringify(a.field)));if("undefined"===typeof a.state[b]&&
-1!==b.indexOf("[")){var f=a._getParentObject(b).replace(/\.field\./g,".state.");eval("if( (typeof "+f+"!== 'undefined')) data.state."+b+"="+JSON.stringify(c)+";")}else a.state[b]=c};a.getState=function(b){try{return"undefined"===typeof a.state[b]&&-1!==b.indexOf("[")?eval("(typeof data.state."+b+"!== 'undefined' ) ? data.state."+b+": undefined;"):a.state[b]}catch(q){}};a.getOld=function(b){try{return"undefined"===typeof a._modelprechangeReal[b]&&-1!==b.indexOf("[")?eval("(typeof data._modelprechangeReal."+
b+"!== 'undefined' ) ? data._modelprechangeReal."+b+": undefined;"):a._modelprechangeReal[b]}catch(q){}};a.get=function(b){try{return"undefined"===typeof a.field[b]&&-1!==b.indexOf("[")?eval("(typeof data.field."+b+"!== 'undefined' ) ? data.field."+b+": undefined;"):a.field[b]}catch(q){}};a.set=function(b,c){if("undefined"===typeof a.field[b]&&-1!==b.indexOf("[")){var f=a._getParentObject(b);eval("if( (typeof "+f+"!== 'undefined')) data.field."+b+"="+JSON.stringify(c)+";")}else a.field[b]=c};a._getParentObject=
function(a,c){"undefined"===typeof c&&(c="data.field.");var b=!1;if(!a)return b;a.indexOf("]")>a.indexOf(".")?b=c+a.replace(a.match(/\[(.*?)\]/gi).pop(),"!").split("!")[0]:(b=a.split("."),b.pop(),b=c+b.join("."));return b};a._delete=a["delete"]=function(b){if("undefined"===typeof a.field[b]&&-1!==b.indexOf("["))try{var c=a._getParentObject(b);eval("if(Object.prototype.toString.call("+c+") === '[object Array]' ){"+c+".splice("+c+".indexOf(data['field']."+b+"),1);} else {if(typeof data['field']."+b+
"!== 'undefined') delete data['field']."+b+";}")}catch(v){console.log(v)}else delete a.field[b]};a.updateValue=function(b,c){"undefined"!==typeof b?a.set(this.getAttribute("name")||this.getAttribute("data-name"),b):a._delete(this.getAttribute("name")||this.getAttribute("data-name"))};a.changed=function(b){var c=function(b){return"undefined"===typeof a._modelprechange[b]||a._modelprechange[b]!=a.field[b]?!0:!1};if("undefined"!==typeof b)return c(b);b=0;for(var f in a.field)if(a.has(a.field,f)&&(b++,
c(f)))return!0;return a._modelpresize!==b?!0:!1};a.diffObjects=function(b,c){function f(a){return a.filter(function(){return!0}).length}null==b&&(b="[object Object]"==Object.prototype.toString.call(c)?{}:[]);null==c&&(c=[],c="[object Object]"==Object.prototype.toString.call(b)?{}:[]);var d=Array.prototype.map?function(a){return Array.prototype.map.apply(a,Array.prototype.slice.call(arguments,1))}:function(a,b){for(var d=Array(a.length),c=0,g=a.length;c<g;c++)d[c]=b(a[c],c);return d.concat()},h=Array.prototype.push;
if(null==b||null==c){if(b!=c)return[["","null",null!=b,null!=c]]}else if("[object Array]"==Object.prototype.toString.call(b)){var l=f(b),p=f(c);if(l!=p)return[["","length",l,p]];l=[];for(var k=0;k<b.length;k++)(p=a.diffObjects(b[k],c[k]))&&h.apply(l,d(p,function(a,b){a[0]="["+k+"]"+a[0];return a}));if(l.length)return l}else if("[object Object]"==Object.prototype.toString.call(b)){l=[];for(var g in b)"undefined"==typeof c[g]&&"undefined"!=typeof b[g]?l.push(["["+g+"]","undefined",b[g],void 0]):(p=
a.diffObjects(b[g],c[g]))&&h.apply(l,d(p,function(a,b){a[0]="["+g+"]"+a[0];return a}));for(g in c)"undefined"==typeof b[g]&&"undefined"!=typeof c[g]&&l.push(["["+g+"]","undefined",void 0,c[g]]);if(l.length)return l}else if(b!=c)return[["","value",b,c]]};a.getChangedModelFields=function(){var b=jsonpatch.compare(a._modelprechangeReal,a.field),c=a.diffObjects(a._modelprechangeReal,a.field);console.log(b,c);return a.diffObjects(a._modelprechangeReal,a.field)};return a}(k_dom);
(function(l,a,h,c){function f(a){function b(a){h.setHtmlValue.call(this,a);"undefined"!==typeof a&&3!==a.nodeType&&d.bind(this);d.postRenderView(this)}var f={};l.config.skeleton&&(f=JSON.parse(JSON.stringify(l)),f.api=null);var d=c.extend(l,a);h.child=d;var t=this;d.model=c=c.extend(c,a.model);d.debug=function(){if(d.config.debug&&"undefined"!==typeof arguments)for(var a in arguments)console.log(arguments[a])};d.updateViewFilter=function(){Array.prototype.forEach.call(t.querySelectorAll("[data-filter]"),
function(a,b){d.viewFilter[h.getXPath(a)]=a.getAttribute("data-filter")})};d.preRenderView=function(a,b){return"undefined"===typeof c.get(h.getName(a))||"__static"===a.getAttribute(p.view)?!1:a.getAttribute("data-filter")?eval("("+a.getAttribute("data-filter").replace(RegExp("this","gi"),"child.filter")+")"):!0};d.postRenderView=function(a){var b=h.getView(a);"undefined"!==typeof d.view.event&&"undefined"!==typeof d.view.event.postRenderView&&"function"===typeof d.view.event.postRenderView[b]&&d.view.event.postRenderView[b].call(c,
a,c.get(h.getName(a)))};d.pre_trigger=function(b){d.updateViewFilter();c._buildModelPreChangeObj();return"undefined"!==typeof a.pre_trigger?a.pre_trigger.call(this,b):!0};d.post_trigger=function(b,f){var g=h.getName(this),n=c.get(g);if(f!=n||c.changed(g))d.debug("changed",f,c.getOld(g),g),d.recognizeChange.setup.call(this),c.updateValue.call(this,f,c.field[g]),"undefined"!==typeof a.post_trigger&&a.post_trigger.call(this,b,a),d.model2View.call(this);return!0};d.validate=function(b,f,h){function g(a){a.value=
f;c.setState(b,a);"function"===typeof f.getName&&d.model2View.call(f);return a.result?f:void 0}if("undefined"!==typeof a.validator&&"function"===typeof a.validator[h])return h=a.validator[h].call(c,f,b),g(h);if("undefined"!==typeof h.result)return g(h);throw{message:"Validator of type "+h+"does not exist.",name:"ValidationException"};};d.changed=function(){"undefined"!==typeof c.event&&"function"===typeof c.event.sync&&c.event.sync.call(c,this,d);"undefined"!==typeof a.sync&&"function"===typeof a.sync&&
a.sync.call(c,this,d);return!0};d.toggle=function(b){if("function"===typeof a.toggle)return a.toggle.call(this,b);b.toggleOmit();d.view2Model(b);return b}.bind(d);d.getDecoValPrimitive=function(a,b){var c=h.getName(a),g=h.getView(a),f=b;if(d.preRenderView(a,b))return g&&(f=d.view.views[g].call(d,b,c,a)),f};d.updateHtmlList=function(a,b,f){function g(){var c=0;for(k in b){var g=h.getName(a),f=a.querySelector('[data-name="'+g+"["+k+']"]');d.preRenderView(a,b[k])?(l=h.parseHTML(d.view.views[p].call(d.view,
b[k],k,a)),c=a.querySelector('[data-name="'+g+"["+c+']"]'),f?f.parentNode.replaceChild(l,f):c?c.parentNode.insertBefore(l,c.nextSibling):a.appendChild(l),d.bind(l),d.postRenderView(l)):f.parentNode.removeChild(f);c=k}}function n(){Array.prototype.forEach.call(a.childNodes,function(g,f){var n=h.getName(g);if("undefined"===typeof n)g.parentNode.removeChild(g);else{var m=/\[(.*?)\]/gi.exec(n)[1];c.get(n)&&"undefined"!==typeof b[m]&&d.preRenderView(a,b[m])||g.parentNode.removeChild(g)}})}var m,k,l,p=
h.getView(a);(function(f){"view-filter"===f[1]&&(n(),g());"undefined"===f[1]&&g();"length"===f[1]&&(f[2]<f[3]&&g(),f[2]>f[3]&&n());if("value"===f[1]){f=f[0];var k=c.get(f),r=/\[(.*?)\]/gi.exec(f)[1];m=a.querySelector(h.getSelector(f,!0));"undefined"!==typeof k&&d.preRenderView(a,b[r])?(l=h.parseHTML(d.view.views[p].call(d.view,b[r],r,a)),m&&m.parentNode.replaceChild(l,m),d.bind(l),d.postRenderView(l),m||a.appendChild(l)):m.parentNode.removeChild(m)}})(f)};d.updateHtmlElement=function(a,f,m){m=h.getName(a);
var g=c.getState(m),n=c.getOld(m);"undefined"===typeof g||g.result||"undefined"!==typeof g&&h.getView(a)!==g.view?n!==f&&(f=d.getDecoValPrimitive(a,f),b.call(a,f)):(a=d.view.views[g.view].call(d,f,m),f=t.querySelector(h.getValidatorSelector(m,g.view)),b.call(f,a))};d.server2Model=function(a){var b=t.querySelector(h.getSelector(a.field));d.post_trigger.call(b,e,a.value)};d.view2Model=function(a){Array.prototype.forEach.call(a.querySelectorAll(d.filter.events)||t.querySelectorAll(d.filter.events),function(a,
b){c.updateValue.call(a,h.value.call(a))})};d.model2View=function(){var a={},b=this;a.finalIteratedAllViewEl=function(b,f,g){for(var m=h.normalizeChangeResponse(f[0]);""!==m;){m=c._getParentObject(m,"");var k=h.getSelector(m,!0);k=b.parents(k);var l=k.getAttribute(p.view.attr);l=d.view.views[l];if(""!==m&&(h.getFieldView(m)||"undefined"!==typeof k&&"undefined"!==typeof l)){g();Array.prototype.forEach.call(k,a.eachViewRepresentation(k.length,f,!0,g));break}}};a.eachViewRepresentation=function(f,g,
k,l){return function(m){var n=h.getName(m),r=m.getAttribute(p.view.attr);n=c.get(n);"__static"===r?h.setPrimitiveValue(m,n):b!==m&&(h.isPrimitiveValue(m)?(r=d.getDecoValPrimitive(m,n),h.hasMultipleChoices(m)?h.selectMultiple(m,r):h.setPrimitiveValue(m,r)):h.isHtmlList(m)?(-1===h.getName(m).indexOf("[")&&(g[1]="view-filter",g[2]=2,g[3]=1),d.updateHtmlList(m,n,g)):d.updateHtmlElement(m,n,g),f--,0>=f&&(k?l():a.finalIteratedAllViewEl(m,g,l)))}};h.findUntilParentExists=function(a){if(""===a)return!1;var b=
h.normalizeChangeResponse(a),d=h.normalizeChangeResponseBrackets(a);b=h.getSelector(b,!0);b=t.querySelectorAll(b);d=0<b.length?b:t.querySelectorAll(h.getSelector(d,!0));return 0===d.length?""===c._getParentObject(a,"")?!1:h.findUntilParentExists(c._getParentObject(a,"")):d};h.updateAllViews=function(b){var f;Array.prototype.forEach.call(t.querySelectorAll("[data-filter]"),function(a){d.viewFilter[h.getXPath(a)]!==a.getAttribute("data-filter")&&b.push([h.getName(a),"view-filter",d.viewFilter[h.getXPath(a)],
a.getAttribute("data-filter")])});var g={},k=void 0;for(f in b){var m=h.findUntilParentExists(b[f][0]);m&&(k=h.getName(m[0]),b[f][0]=k,g[k]=[m,b[f]])}for(var l in g)m=g[l][0],b=g[l][1],Array.prototype.forEach.call(m,a.eachViewRepresentation(m.length,b,!0,function(a){var d=h.getName(a[0]);return function(a){"undefined"!==typeof c.event&&"undefined"!==typeof c.event.postChange&&"function"===typeof c.event.postChange[d]&&c.event.postChange[d].call(c,c.get(d),b,"controller")}}(m)))};h.updateAllViews(c.getChangedModelFields()||
[])};d.recognizeChange=function(){var a={changed:function(a){d.changed.call(a);delete d.timeoutID},cancel:function(){"number"===typeof d.timeoutID&&(window.clearTimeout(d.timeoutID),delete d.timeoutID)},setup:function(){var b=this;a.cancel();d.timeoutID=window.setTimeout(function(c){a.changed(b)},b.getAttribute(p.delay.attr)||d.delay)}};return a}();d.dispatchEvents=function(){var a=[];if(this.getAttribute(p.on.attr)){var b=(this.getAttribute(p.on.attr)||"").split(","),c=0;a={};for(c in b){var d=b[c].trim();
d=d.split("->");a[d[0]]=1<d.length?d[1]:d[0]}}return a};d.dispatchFilter=function(b){return{object:a,$el:b}};d.bind=function(a){function b(a){l=h.getName(a);a=d.applyMethods(a);if(l)for(k in g[l]=d.dispatchEvents.call(a),g[l]){d.debug("name:"+l+", event:"+k);d.config.skeleton&&("undefined"===typeof f.interactions[l]&&(f.interactions[l]={}),f.interactions[l][k]="function(e, self){}");var b=v(a,k);a.removeEventListener(k,b);a.addEventListener(k,b);"model"===t.getAttribute("data-defaultvalues")||h.getParents(t,
'[data-defaultvalues="model"]')||(w=h.value.call(a),c.updateValue.call(a,w))}}var g={},k={},l="",q="";var u=d.dispatchFilter(a);var t=a;var v=function(a,b){return function(c,f){l=h.getName(a);q=g[l][b];if(!1!==d.pre_trigger.call(a,c)){if("undefined"!==typeof d.interactions[l]&&"undefined"!==typeof d.interactions[l][q]){var k=d.interactions[l][q].call(a,c,d,f);"true"===a.getAttribute(p.omit.attr)&&(k=h.value.call(a))}else"undefined"!==typeof d.interactions[q]&&"undefined"!==typeof d.interactions[q][b]?
(k=d.interactions[q][b].call(a,c,d,f),"true"===a.getAttribute(p.omit.attr)&&(k=h.value.call(a))):k=h.value.call(a);d.post_trigger.call(a,c,k)}}};u.events=u.$el.querySelectorAll("["+p.on.attr+"]");var w="";Array.prototype.forEach.call(u.events,b);b(u.$el);"model"===t.getAttribute("data-defaultvalues")&&d.model2View.call(t);return u};d.applyMethods=function(a){a.getName=function(){return h.getName(this)}.bind(a);a.getValue=function(a,b){"undefined"===typeof a&&(a="dom");return"model"!==a?h.getValue(this,
b):c.get(h.getName(this))}.bind(a);a.setValue=function(a){h.setPrimitiveValue(this,a)}.bind(a);return a};d.init=function(){d.filter=d.bind(this);"undefined"!==typeof a.init&&a.init(d)&&d.recognizeChange.setup()}.bind(this);d.ajax=function(a,b){var c=new XMLHttpRequest;c.open(a,b);c.setup=function(a){a(c);return c};c.done=function(a){c.onreadystatechange=function(){4===c.readyState&&a(c.responseText)};return c};return c};if(d.view.viewpath){var w=Object.keys(d.view.views).length,x=1,k;for(k in d.view.views)d.ajax("get",
d.view.viewpath+k+"."+d.view.fileextension+"?v="+(d.config.debug?Math.random():"1")).done(function(b){return function(c){d.view.templates_[d.view.views[b]]=c;d.view.templates_[b]=c;w<=x&&(a.view.templates_=d.view.templates_,d.init());x++}}(k)).send()}else d.init()}var p=a["dom-attributes"];window.$k=function(a){return f.bind(document.querySelector(a))}})(k_structure,k_docapi,k_dom,k_data);
